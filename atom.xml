<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>uiste</title>
  <icon>https://www.gravatar.com/avatar/56992660d6f2c687a02a62364e5b9baf</icon>
  <subtitle>uiste</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.uiste.com/"/>
  <updated>2019-03-29T03:29:57.139Z</updated>
  <id>http://blog.uiste.com/</id>
  
  <author>
    <name>uiste</name>
    <email>hi@uiste.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>立个flag</title>
    <link href="http://blog.uiste.com/2019/20190329-3.html"/>
    <id>http://blog.uiste.com/2019/20190329-3.html</id>
    <published>2019-03-29T03:25:31.000Z</published>
    <updated>2019-03-29T03:29:57.139Z</updated>
    
    <content type="html"><![CDATA[<p>好久都没有在这里写笔记了。记录的地方比较零散，有道云、OneNote、web博客(域名迁移备案失效，服务器也关闭了)。有时候突然想要查找一些内容都忘记放在哪里了。也就只能是一个记录过程却少了一些查找的过程。立个flag以后继续记录在这里了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;好久都没有在这里写笔记了。记录的地方比较零散，有道云、OneNote、web博客(域名迁移备案失效，服务器也关闭了)。有时候突然想要查找一些内容都忘记放在哪里了。也就只能是一个记录过程却少了一些查找的过程。立个flag以后继续记录在这里了。&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>nginx 配置</title>
    <link href="http://blog.uiste.com/2019/20190329-2.html"/>
    <id>http://blog.uiste.com/2019/20190329-2.html</id>
    <published>2019-03-29T02:32:49.000Z</published>
    <updated>2019-03-29T03:06:22.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">upstream http_server &#123;</span><br><span class="line">server x.x.x.x weight=10; # 权重</span><br><span class="line">server x.x.x.x weight=20; # 权重</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream backend &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    server 127.0.0.1:9090;</span><br><span class="line">    ip_hash; # ip_hash</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>nginx 转发比较消耗CPU</p></blockquote><h1 id="nginx-转发"><a href="#nginx-转发" class="headerlink" title="nginx 转发"></a>nginx 转发</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 8888;</span><br><span class="line">server name localhost;</span><br><span class="line"></span><br><span class="line">#access_log logs/host.access.log main;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">root /home/...;</span><br><span class="line">index index.html index.htm</span><br><span class="line"></span><br><span class="line">if (!-e $request_filename) &#123; # 找不到请求地址</span><br><span class="line">proxy_pass http://127.0.0.1:8811; # 单机转发 外网IP</span><br><span class="line">#proxy_pass http://http_server; # 负载均衡名称</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nginx-的-upstream权重配置"><a href="#nginx-的-upstream权重配置" class="headerlink" title="nginx 的 upstream权重配置"></a>nginx 的 upstream权重配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">权重配置：</span><br><span class="line"></span><br><span class="line">weight和请求数量成正比，主要用于上游服务器配置不均衡的情况。下面的配置中，192.168.10.2机器的请求量是192.168.10.1机器请求量的2倍。</span><br><span class="line"></span><br><span class="line">upstream nodes &#123;</span><br><span class="line"></span><br><span class="line">server 192.168.10.1:8668 weight=5;</span><br><span class="line"></span><br><span class="line">server 192.168.10.2:8668 weight=10;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip_hash配置：</span><br><span class="line"></span><br><span class="line">每一个请求按照请求的ip的hash结果分配。这样每一个请求固定落在一个上游服务器，能够解决ip会话在同一台服务器的问题。</span><br><span class="line"></span><br><span class="line">upstream nodes &#123;</span><br><span class="line"></span><br><span class="line">ip_hash;</span><br><span class="line"></span><br><span class="line">server 192.168.10.1:8668;</span><br><span class="line"></span><br><span class="line">server 192.168.10.2:8668;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fair配置：</span><br><span class="line"></span><br><span class="line">按上游服务器的响应时间来分配请求。响应时间短的优先分配。</span><br><span class="line"></span><br><span class="line">upstream nodes &#123;</span><br><span class="line"></span><br><span class="line">server 192.168.10.1:8668;</span><br><span class="line"></span><br><span class="line">server 192.168.10.2:8668;</span><br><span class="line"></span><br><span class="line">fair;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url_hash配置：</span><br><span class="line"></span><br><span class="line">按照访问的url的hash结果来分配请求，使每一个url定向到同一个上游服务器。注意：在upstream中加入hash语句。server语句中不能写入weight等其他的參数，hash_method是使用的hash算法。</span><br><span class="line"></span><br><span class="line">upstream nodes &#123;</span><br><span class="line"></span><br><span class="line">server 192.168.10.1:8668;</span><br><span class="line"></span><br><span class="line">server 192.168.10.2:8668;</span><br><span class="line"></span><br><span class="line">hash $request_uri;</span><br><span class="line"></span><br><span class="line">hash_method crc32;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">下面再说下在upstream中常用的配置项：</span><br><span class="line"></span><br><span class="line">down：表示当前的server不參与负载均衡。</span><br><span class="line"></span><br><span class="line">weight：默觉得1，weight越大，负载的权重就越大。</span><br><span class="line"></span><br><span class="line">max_fails ：请求失败的次数默觉得1。</span><br><span class="line"></span><br><span class="line">fail_timeout : max_fails次失败后，暂停请求此台服务器的时间。</span><br><span class="line"></span><br><span class="line">backup： 其他全部的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。</span><br><span class="line"></span><br><span class="line">upstream nodes &#123;</span><br><span class="line"></span><br><span class="line">ip_hash;</span><br><span class="line"></span><br><span class="line">server 192.168.10.1:8668 down;</span><br><span class="line"></span><br><span class="line">server 192.168.10.2:8668 weight=2;</span><br><span class="line"></span><br><span class="line">server 192.168.10.3:8668;</span><br><span class="line"></span><br><span class="line">server 192.168.10.4:8668 backup;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Linux命令"><a href="#Linux命令" class="headerlink" title="Linux命令"></a>Linux命令</h1><h2 id="机器名"><a href="#机器名" class="headerlink" title="机器名"></a>机器名</h2><p><code>hostname -i</code></p><h2 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h2><p><code>netstat -anp | grep 8888</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;负载均衡&quot;&gt;&lt;a href=&quot;#负载均衡&quot; class=&quot;headerlink&quot; title=&quot;负载均衡&quot;&gt;&lt;/a&gt;负载均衡&lt;/h1&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>sheel 脚本</title>
    <link href="http://blog.uiste.com/2019/20190329-1.html"/>
    <id>http://blog.uiste.com/2019/20190329-1.html</id>
    <published>2019-03-29T01:53:51.000Z</published>
    <updated>2019-03-29T02:33:10.927Z</updated>
    
    <content type="html"><![CDATA[<h1 id="reload-sh-平滑重启"><a href="#reload-sh-平滑重启" class="headerlink" title="reload.sh  平滑重启"></a>reload.sh  平滑重启</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;loading...&quot;</span><br><span class="line">pid = `pidof live_master`</span><br><span class="line">echo $pid</span><br><span class="line">kill -USR1 $pid</span><br><span class="line">echo &apos;&quot;loading success&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;reload-sh-平滑重启&quot;&gt;&lt;a href=&quot;#reload-sh-平滑重启&quot; class=&quot;headerlink&quot; title=&quot;reload.sh  平滑重启&quot;&gt;&lt;/a&gt;reload.sh  平滑重启&lt;/h1&gt;&lt;figure class=&quot;highligh
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>mysql 常见问题</title>
    <link href="http://blog.uiste.com/2019/20190328-1.html"/>
    <id>http://blog.uiste.com/2019/20190328-1.html</id>
    <published>2019-03-28T03:12:26.000Z</published>
    <updated>2019-03-28T03:46:42.951Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql8-0-设置简单密码报错ERROR-1819-HY000-Your-password-does-not-satisfy-the-current-policy-requirements"><a href="#mysql8-0-设置简单密码报错ERROR-1819-HY000-Your-password-does-not-satisfy-the-current-policy-requirements" class="headerlink" title="mysql8.0 设置简单密码报错ERROR 1819 (HY000): Your password does not satisfy the current policy requirements"></a>mysql8.0 设置简单密码报错ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &apos;validate_password%&apos;;</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| validate_password.check_user_name    | ON     |</span><br><span class="line">| validate_password.dictionary_file    |        |</span><br><span class="line">| validate_password.length             | 8      |</span><br><span class="line">| validate_password.mixed_case_count   | 1      |</span><br><span class="line">| validate_password.number_count       | 1      |</span><br><span class="line">| validate_password.policy             | MEDIUM |</span><br><span class="line">| validate_password.special_char_count | 1      |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">7 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password.policy=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global validate_password.length=4;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit;</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">➜  ~ mysql_secure_installation</span><br><span class="line"></span><br><span class="line">Securing the MySQL server deployment.</span><br><span class="line"></span><br><span class="line">Enter password for user root:</span><br><span class="line">Error: Access denied for user &apos;root&apos;@&apos;localhost&apos; (using password: YES)</span><br></pre></td></tr></table></figure><h2 id="Syntax-error-or-access-violation-1055-Expression-1-of-SELECT-list-is-not-in-GROUP-BY-clause-and-contains-nonaggregated-column-‘XXX-Y-ZZZZ’-which-is-not-functionally-dependent-on-columns-in-GROUP-BY-clause-this-is-incompatible-with-sql-mode-only-full-group-by"><a href="#Syntax-error-or-access-violation-1055-Expression-1-of-SELECT-list-is-not-in-GROUP-BY-clause-and-contains-nonaggregated-column-‘XXX-Y-ZZZZ’-which-is-not-functionally-dependent-on-columns-in-GROUP-BY-clause-this-is-incompatible-with-sql-mode-only-full-group-by" class="headerlink" title="Syntax error or access violation: 1055 Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column ‘XXX.Y.ZZZZ’ which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by"></a>Syntax error or access violation: 1055 Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column ‘XXX.Y.ZZZZ’ which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</h2><blockquote><p>原因：<br>MySQL 5.7.5和up实现了对功能依赖的检测。如果启用了only_full_group_by SQL模式(在默认情况下是这样)，那么MySQL就会拒绝选择列表、条件或顺序列表引用的查询，这些查询将引用组中未命名的非聚合列，而不是在功能上依赖于它们。(在5.7.5之前，MySQL没有检测到功能依赖项，only_full_group_by在默认情况下是不启用的。关于前5.7.5行为的描述，请参阅MySQL 5.6参考手册。)</p></blockquote><p>执行以下个命令，可以查看 sql_mode 的内容。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">　　mysql&gt; SHOW SESSION VARIABLES;</span><br><span class="line"></span><br><span class="line">　　</span><br><span class="line">　　mysql&gt; SHOW GLOBAL VARIABLES;</span><br><span class="line"></span><br><span class="line">　　mysql&gt; select @@sql_mode;</span><br></pre></td></tr></table></figure></p><p>可见session和global 的sql_mode的值都为： </p><p><code>ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code></p><p>only_full_group_by说明：<br>only_full_group_by ：使用这个就是使用和oracle一样的group 规则, select的列都要在group中,或者本身是聚合列(SUM,AVG,MAX,MIN) 才行，其实这个配置目前个人感觉和distinct差不多的，所以去掉就好<br>官网摘抄：<br>官网：ONLY_FULL_GROUP_BY<br>Reject queries for which the select list, HAVING condition, or ORDER BY list refer to nonaggregated columns that are neither named in the GROUP BY clause nor are functionally dependent on (uniquely determined by) GROUP BY columns.</p><p>As of MySQL 5.7.5, the default SQL mode includes ONLY_FULL_GROUP_BY. (Before 5.7.5, MySQL does not detect functional dependency and ONLY_FULL_GROUP_BY is not enabled by default. For a description of pre-5.7.5 behavior, see the MySQL 5.6 Reference Manual.)</p><p>A MySQL extension to standard SQL permits references in the HAVING clause to aliased expressions in the select list. Before MySQL 5.7.5, enabling ONLY_FULL_GROUP_BY disables this extension, thus requiring the HAVING clause to be written using unaliased expressions. As of MySQL 5.7.5, this restriction is lifted so that the HAVING clause can refer to aliases regardless of whether ONLY_FULL_GROUP_BY is enabled.</p><p>解决：<br>执行以下两个命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global sql_mode=&apos;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt; set session sql_mode=&apos;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;;</span><br></pre></td></tr></table></figure></p><p>这两个命令，去掉 sql_mode 的 ONLY_FULL_GROUP_BY</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;mysql8-0-设置简单密码报错ERROR-1819-HY000-Your-password-does-not-satisfy-the-current-policy-requirements&quot;&gt;&lt;a href=&quot;#mysql8-0-设置简单密码报错ERROR-1
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>swoole</title>
    <link href="http://blog.uiste.com/2019/20190325-3.html"/>
    <id>http://blog.uiste.com/2019/20190325-3.html</id>
    <published>2019-03-25T09:10:47.000Z</published>
    <updated>2019-03-29T02:56:10.026Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装PHP"><a href="#安装PHP" class="headerlink" title="安装PHP"></a>安装PHP</h2><h2 id="安装sowoole-扩展"><a href="#安装sowoole-扩展" class="headerlink" title="安装sowoole 扩展"></a>安装sowoole 扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  package cd swoole</span><br><span class="line">➜  swoole git:(master) phpize</span><br><span class="line">Configuring for:</span><br><span class="line">PHP Api Version:         20170718</span><br><span class="line">Zend Module Api No:      20170718</span><br><span class="line">Zend Extension Api No:   320170718</span><br><span class="line">➜  swoole git:(master) ./configure</span><br><span class="line">➜  swoole git:(master) make &amp;&amp; make installs</span><br><span class="line"></span><br><span class="line">···</span><br><span class="line">Build complete.</span><br><span class="line">Don&apos;t forget to run &apos;make test&apos;.</span><br><span class="line"></span><br><span class="line">Installing shared extensions:     /usr/local/Cellar/php@7.2/7.2.16/pecl/20170718/</span><br><span class="line">Installing header files:          /usr/local/Cellar/php@7.2/7.2.16/include/php/</span><br></pre></td></tr></table></figure><h2 id="ws-server"><a href="#ws-server" class="headerlink" title="ws_server"></a>ws_server</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ws</span> </span>&#123;</span><br><span class="line">    <span class="keyword">CONST</span> HOST = <span class="string">"0.0.0.0"</span>;</span><br><span class="line">    <span class="keyword">CONST</span> PORT = <span class="number">8811</span>;</span><br><span class="line">    <span class="keyword">CONST</span> CHART_PORT = <span class="number">8812</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $ws = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取 key 有值 del</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws = <span class="keyword">new</span> swoole_websocket_server(<span class="keyword">self</span>::HOST, <span class="keyword">self</span>::PORT);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;listen(<span class="keyword">self</span>::HOST, <span class="keyword">self</span>::CHART_PORT, SWOOLE_SOCK_TCP);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;set(</span><br><span class="line">            [</span><br><span class="line">                <span class="string">'enable_static_handler'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">                <span class="string">'document_root'</span> =&gt; <span class="string">"/home/work/hdtocs/swoole_mooc/thinkphp/public/static"</span>,</span><br><span class="line">                <span class="string">'worker_num'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">                <span class="string">'task_worker_num'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"start"</span>, [<span class="keyword">$this</span>, <span class="string">'onStart'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"open"</span>, [<span class="keyword">$this</span>, <span class="string">'onOpen'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"message"</span>, [<span class="keyword">$this</span>, <span class="string">'onMessage'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"workerstart"</span>, [<span class="keyword">$this</span>, <span class="string">'onWorkerStart'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"request"</span>, [<span class="keyword">$this</span>, <span class="string">'onRequest'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"task"</span>, [<span class="keyword">$this</span>, <span class="string">'onTask'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"finish"</span>, [<span class="keyword">$this</span>, <span class="string">'onFinish'</span>]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;on(<span class="string">"close"</span>, [<span class="keyword">$this</span>, <span class="string">'onClose'</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;ws-&gt;start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $server</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">($server)</span> </span>&#123;</span><br><span class="line">        swoole_set_process_name(<span class="string">"live_master"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $server</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $worker_id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onWorkerStart</span><span class="params">($server,  $worker_id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定义应用目录</span></span><br><span class="line">        define(<span class="string">'APP_PATH'</span>, <span class="keyword">__DIR__</span> . <span class="string">'/../../../application/'</span>);</span><br><span class="line">        <span class="comment">// 加载框架里面的文件</span></span><br><span class="line">        <span class="comment">//require __DIR__ . '/../thinkphp/base.php';</span></span><br><span class="line">        <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/../../../thinkphp/start.php'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * request回调</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span><span class="params">($request, $response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($request-&gt;server[<span class="string">'request_uri'</span>] == <span class="string">'/favicon.ico'</span>) &#123;</span><br><span class="line">            $response-&gt;status(<span class="number">404</span>);</span><br><span class="line">            $response-&gt;end();</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SERVER  =  [];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($request-&gt;server)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>($request-&gt;server <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $_SERVER[strtoupper($k)] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($request-&gt;header)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>($request-&gt;header <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $_SERVER[strtoupper($k)] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $_GET = [];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($request-&gt;get)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>($request-&gt;get <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $_GET[$k] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $_FILES = [];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($request-&gt;files)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>($request-&gt;files <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $_FILES[$k] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $_POST = [];</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($request-&gt;post)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span>($request-&gt;post <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">                $_POST[$k] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeLog();</span><br><span class="line">        $_POST[<span class="string">'http_server'</span>] = <span class="keyword">$this</span>-&gt;ws;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="comment">// 执行应用并响应</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            think\Container::get(<span class="string">'app'</span>, [APP_PATH])</span><br><span class="line">                -&gt;run()</span><br><span class="line">                -&gt;send();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="comment">// todo</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $res = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        $response-&gt;end($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $serv</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $taskId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $workerId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onTask</span><span class="params">($serv, $taskId, $workerId, $data)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分发 task 任务机制，让不同的任务 走不同的逻辑</span></span><br><span class="line">        $obj = <span class="keyword">new</span> app\common\lib\task\Task;</span><br><span class="line"></span><br><span class="line">        $method = $data[<span class="string">'method'</span>];</span><br><span class="line">        $flag = $obj-&gt;$method($data[<span class="string">'data'</span>], $serv);</span><br><span class="line">        <span class="comment">/*$obj = new app\common\lib\ali\Sms();</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">            $response = $obj::sendSms($data['phone'], $data['code']);</span></span><br><span class="line"><span class="comment">        &#125;catch (\Exception $e) &#123;</span></span><br><span class="line"><span class="comment">            // todo</span></span><br><span class="line"><span class="comment">            echo $e-&gt;getMessage();</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $flag; <span class="comment">// 告诉worker</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $serv</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $taskId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onFinish</span><span class="params">($serv, $taskId, $data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"taskId:&#123;$taskId&#125;\n"</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"finish-data-sucess:&#123;$data&#125;\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听ws连接事件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $ws</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $request</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onOpen</span><span class="params">($ws, $request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// fd redis [1]</span></span><br><span class="line">        \app\common\lib\redis\Predis::getInstance()-&gt;sAdd(config(<span class="string">'redis.live_game_key'</span>), $request-&gt;fd);</span><br><span class="line">        var_dump($request-&gt;fd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听ws消息事件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $ws</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $frame</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onMessage</span><span class="params">($ws, $frame)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"ser-push-message:&#123;$frame-&gt;data&#125;\n"</span>;</span><br><span class="line">        $ws-&gt;push($frame-&gt;fd, <span class="string">"server-push:"</span>.date(<span class="string">"Y-m-d H:i:s"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * close</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $ws</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $fd</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">onClose</span><span class="params">($ws, $fd)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// fd del</span></span><br><span class="line">        \app\common\lib\redis\Predis::getInstance()-&gt;sRem(config(<span class="string">'redis.live_game_key'</span>), $fd);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"clientid:&#123;$fd&#125;\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">writeLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $datas = array_merge([<span class="string">'date'</span> =&gt; date(<span class="string">"Ymd H:i:s"</span>)],$_GET, $_POST, $_SERVER);</span><br><span class="line"></span><br><span class="line">        $logs = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">foreach</span>($datas <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            $logs .= $key . <span class="string">":"</span> . $value . <span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        swoole_async_writefile(APP_PATH.<span class="string">'../runtime/log/'</span>.date(<span class="string">"Ym"</span>).<span class="string">"/"</span>.date(<span class="string">"d"</span>).<span class="string">"_access.log"</span>, $logs.PHP_EOL, <span class="function"><span class="keyword">function</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">            <span class="comment">// todo</span></span><br><span class="line">        &#125;, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Ws();</span><br></pre></td></tr></table></figure><h2 id="ws-client"><a href="#ws-client" class="headerlink" title="ws_client"></a>ws_client</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>singwa-swoole-ws测试<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> wsUrl = <span class="string">"ws://swoole.demo.com:8812"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> websocket = <span class="keyword">new</span> WebSocket(wsUrl);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//实例对象的onopen属性</span></span></span><br><span class="line"><span class="javascript">    websocket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      websocket.send(<span class="string">"hello-sinwa"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"conected-swoole-success"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 实例化 onmessage</span></span></span><br><span class="line"><span class="javascript">    websocket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"ws-server-return-data:"</span> + evt.data);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//onclose</span></span></span><br><span class="line"><span class="javascript">    websocket.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"close"</span>);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//onerror</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    websocket.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">evt, e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">"error:"</span> + evt.data);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"> </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="定时器"><a href="#定时器" class="headerlink" title="定时器"></a>定时器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Server &#123;</span><br><span class="line">    const PORT = 8811;</span><br><span class="line"></span><br><span class="line">    public function port() &#123;</span><br><span class="line">        $shell  =  &quot;netstat -anp 2&gt;/dev/null | grep &quot;. self::PORT . &quot; | grep LISTEN | wc -l&quot;;</span><br><span class="line"></span><br><span class="line">        $result = shell_exec($shell);</span><br><span class="line">        if($result != 1) &#123;</span><br><span class="line">            // 发送报警服务 邮件 短信</span><br><span class="line">            /// todo</span><br><span class="line">            echo date(&quot;Ymd H:i:s&quot;).&quot;error&quot;.PHP_EOL;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            echo date(&quot;Ymd H:i:s&quot;).&quot;succss&quot;.PHP_EOL;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// nohup</span><br><span class="line">swoole_timer_tick(2000, function($timer_id) &#123;</span><br><span class="line">    (new Server())-&gt;port();</span><br><span class="line">    echo &quot;time-start&quot;.PHP_EOL;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;安装PHP&quot;&gt;&lt;a href=&quot;#安装PHP&quot; class=&quot;headerlink&quot; title=&quot;安装PHP&quot;&gt;&lt;/a&gt;安装PHP&lt;/h2&gt;&lt;h2 id=&quot;安装sowoole-扩展&quot;&gt;&lt;a href=&quot;#安装sowoole-扩展&quot; class=&quot;headerli
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>php-ini 文件</title>
    <link href="http://blog.uiste.com/2019/20190325-2.html"/>
    <id>http://blog.uiste.com/2019/20190325-2.html</id>
    <published>2019-03-25T08:54:44.000Z</published>
    <updated>2019-03-25T08:59:14.073Z</updated>
    
    <content type="html"><![CDATA[<h1 id="多个版本改哪个文件下的php-ini-配置才有效？"><a href="#多个版本改哪个文件下的php-ini-配置才有效？" class="headerlink" title="多个版本改哪个文件下的php.ini 配置才有效？"></a>多个版本改哪个文件下的php.ini 配置才有效？</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  package php -i | grep php.ini</span><br><span class="line">Configuration File (php.ini) Path =&gt; /usr/local/etc/php/7.2</span><br><span class="line">Loaded Configuration File =&gt; /usr/local/etc/php/7.2/php.ini</span><br></pre></td></tr></table></figure><h1 id="别名设置"><a href="#别名设置" class="headerlink" title="别名设置"></a>别名设置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  package vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line">alias php72=/Users/uiste/Downloads/package/soft/php/bin/php</span><br><span class="line"></span><br><span class="line">➜  package source ~/.bash_profile</span><br></pre></td></tr></table></figure><h1 id="编译时指定PHP配置信息"><a href="#编译时指定PHP配置信息" class="headerlink" title="编译时指定PHP配置信息"></a>编译时指定PHP配置信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ./configure \</span><br><span class="line">--prefix=/usr/local/php \ # 安装路径</span><br><span class="line">--with-config-file-path=/etc # 配置路径</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;多个版本改哪个文件下的php-ini-配置才有效？&quot;&gt;&lt;a href=&quot;#多个版本改哪个文件下的php-ini-配置才有效？&quot; class=&quot;headerlink&quot; title=&quot;多个版本改哪个文件下的php.ini 配置才有效？&quot;&gt;&lt;/a&gt;多个版本改哪个文件下的
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>PHP 7.2 升级后 Yii2 升级</title>
    <link href="http://blog.uiste.com/2019/20190325-1.html"/>
    <id>http://blog.uiste.com/2019/20190325-1.html</id>
    <published>2019-03-25T07:03:44.000Z</published>
    <updated>2019-03-25T07:29:29.726Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><blockquote><p>PHP升级7.2后，Yii 2.0.12 版本由于类命名约束问题会产生如下问题：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Cannot use &apos;Object&apos; as class name as it is reserved in /Users/uiste/www/my_project/mike-app/vendor/yiisoft/yii2/base/Object.php on line 77</span><br></pre></td></tr></table></figure><h2 id="升级方法"><a href="#升级方法" class="headerlink" title="升级方法"></a>升级方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  mike-app git:(version-update) composer install</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Installing dependencies (including require-dev) from lock file</span><br><span class="line">Nothing to install or update</span><br><span class="line">Generating autoload files</span><br><span class="line">➜  mike-app git:(version-update) composer global require &quot;fxp/composer-asset-plugin:^1.4.1&quot;</span><br><span class="line">Changed current directory to /Users/uiste/.composer</span><br><span class="line">./composer.json has been updated</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Updating dependencies (including require-dev)</span><br><span class="line">Package operations: 0 installs, 1 update, 0 removals</span><br><span class="line">  - Updating fxp/composer-asset-plugin (v1.2.2 =&gt; v1.4.4): Downloading (100%)         </span><br><span class="line">Writing lock file</span><br><span class="line">Generating autoload files</span><br><span class="line">➜  mike-app git:(version-update) composer update yiisoft/yii2 yiisoft/yii2-composer bower-asset/jquery.inputmask</span><br><span class="line">The &quot;extra.asset-installer-paths&quot; option is deprecated, use the &quot;config.fxp-asset.installer-paths&quot; option</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Updating dependencies (including require-dev)                                                                                                                     GitHub API limit (60 calls/hr) is exhausted, could not fetch https://api.github.com/repos/RobinHerbots/Inputmask/contents/bower.json?ref=4.x. Create a GitHub OAuth token to go over the API rate limit. You can also wait until 2019-03-25 07:52:25 for the rate limit to reset.</span><br><span class="line"></span><br><span class="line">Head to https://github.com/settings/tokens/new?scopes=repo&amp;description=Composer+on+uiste+2019-03-25+0657</span><br><span class="line">to retrieve a token. It will be stored in &quot;/Users/uiste/.composer/auth.json&quot; for future use by Composer.</span><br><span class="line">Token (hidden):</span><br></pre></td></tr></table></figure><blockquote><p>浏览器打开：<br><code>https://github.com/settings/tokens/new?scopes=repo&amp;description=Composer+on+localhost.localdomain+2019-03-25+1945</code><br>登录github账号 生成token ，在命令行输入即可 token</p></blockquote><p>继续<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer updated</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;PHP升级7.2后，Yii 2.0.12 版本由于类命名约束问题会产生如下问题：&lt;/p&gt;
&lt;/blockquote
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Mac 配置ssh 免密登录</title>
    <link href="http://blog.uiste.com/2018/20181102-3.html"/>
    <id>http://blog.uiste.com/2018/20181102-3.html</id>
    <published>2018-11-02T07:49:00.000Z</published>
    <updated>2018-11-02T07:58:06.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 配置ssh</span><br><span class="line">~ vim ~/.ssh/config</span><br><span class="line"></span><br><span class="line">Host *</span><br><span class="line">    ServerAliveInterval 10</span><br><span class="line"></span><br><span class="line">Host Mweb1</span><br><span class="line">    HostName        服务器IP地址</span><br><span class="line">    Port            端口</span><br><span class="line">    User            用户名</span><br><span class="line">    IdentityFile    私钥地址</span><br><span class="line"></span><br><span class="line">Host Mweb2</span><br><span class="line">    HostName        服务器IP地址</span><br><span class="line">    Port            22</span><br><span class="line">    User            uiste</span><br><span class="line">    IdentityFile    ~/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line"># 登录方式</span><br><span class="line">➜  ~ ssh Mweb1</span><br><span class="line">Last login: Fri Nov  2 08:15:51 2018 from 180.173.83.33</span><br><span class="line">[root@VM_0_6_centos ~]#</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Mac配置远程服务器隧道代理</title>
    <link href="http://blog.uiste.com/2018/20181102-2.html"/>
    <id>http://blog.uiste.com/2018/20181102-2.html</id>
    <published>2018-11-02T07:44:54.000Z</published>
    <updated>2018-11-03T00:13:03.743Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>因为安全原因远程服务器的数据库不允许本地直接访问，又没有开启访问IP白名单时，可以通过隧道代理访问。Windows系统通过xsheel可以设置隧道代理。Mac只需要运行如下命令</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 22  -i ~/.ssh/id_rsa -fNL 代理端口:代理IP:转发原端口 用户名@远程服务器IP</span><br><span class="line"></span><br><span class="line">ssh -p 22  -i ~/.ssh/id_rsa -fNL 3308:127.0.0.1:3306 root@118.xx.xxx.xx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -p &#123;ssh_port&#125; -i &#123;rsa_file&#125; -fNL &#123;local_port&#125;:&#123;mysql_ip&#125;:&#123;mysql_port&#125; </span><br><span class="line">&#123;ssh_user&#125;@&#123;ssh_ip&#125;</span><br><span class="line">ssh -p 22  -i ./id_rsa_jump -fNL 33060:mysql_ip:3306 jump@jump_ip   # 实例</span><br></pre></td></tr></table></figure><blockquote><p>-p {ssh_port}: 指定跳板机器的ssh服务的端口<br>-i {rsa_file}:指定连接跳板机的ssh公钥，由跳板机的ssh服务端生成，如果不指定公钥或者公钥验证失败则会弹出密码进行登录。<br>-f:需进行ssh认证<br>-N:只进行端口转发，不执行命令<br>-L:指定连接服务的格式 [bind_address:]port:host:hostport<br>{local_port}：本地监听的端口<br>{mysql_ip}：转发到的mysql的ip或域名<br>{mysql_port}：转发到的mysql的端口<br>{ssh_port}：跳板机的<br>{ssh_user}：跳板机的ssh用户名(如果为rsa登录，则ras对应的用户名和ssh_user一致)<br>{ssh_ip}：跳板机的ip或域名<br>检查是否启动成功<br>netstat  -aon|findstr  “33060”  #存在对应的监听则启动成功 如果要关闭则kill<br>连接mysql<br>ip:127.0.0.1<br>port:33060</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;因为安全原因远程服务器的数据库不允许本地直接访问，又没有开启访问IP白名单时，可以通过隧道代理访问。Windows系统通过xsheel可以设置隧道代理。Mac只需要运行如下命令&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;hi
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>truffle geth 启动Ethereum测试节点</title>
    <link href="http://blog.uiste.com/2018/20181102-1.html"/>
    <id>http://blog.uiste.com/2018/20181102-1.html</id>
    <published>2018-11-02T07:42:14.000Z</published>
    <updated>2018-11-02T07:58:06.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="truffle-框架使用"><a href="#truffle-框架使用" class="headerlink" title="truffle 框架使用"></a>truffle 框架使用</h1><p><strong> uiste@uiste:~$     testrpc </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">uiste@uiste:~/www/blockchain/test_truffle_2$     truffle unbox webpack</span><br><span class="line">uiste@uiste:~/www/blockchain/test_truffle_2$     truffle develop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Mon Apr  2 20:07:27 on ttys008</span><br><span class="line">uiste@uiste:~$     cd www/blockchain/test_truffle_2/</span><br><span class="line">uiste@uiste:~/www/blockchain/test_truffle_2$     npm run dev</span><br></pre></td></tr></table></figure></p><h1 id="geth-方式"><a href="#geth-方式" class="headerlink" title="geth 方式"></a>geth 方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">`geth --datadir &quot;./Mychains/dev&quot; --identity &quot;mydev&quot; --rpccorsdomain &quot;*&quot; --networkid 99 console`</span><br><span class="line"></span><br><span class="line">uiste@uiste:~$     cd www/blockchain/test-geth</span><br><span class="line">uiste@uiste:~/www/blockchain/test-geth$     geth --datadir &quot;./Mychains/dev&quot; --identity &quot;mydev&quot; --rpc --rpcapi &quot;db,eth,net,web3,personal,web3&quot; --nodiscover --rpccorsdomain &quot;*&quot; --networkid 100 console</span><br><span class="line"></span><br><span class="line">uiste@uiste:/Applications$      /Applications/Mist.app/Contents/MacOS/Mist --rpc &quot;/Users/uiste/www/blockchain/test-geth/Mychains/dev/geth.ipc&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir &quot;./chain&quot; --identity &quot;mydev&quot; --rpc --rpcapi &quot;db,eth,net,web3,personal,web3&quot; --nodiscover --rpccorsdomain &quot;*&quot; --networkid 100 console 2&gt;&gt;eth_output.log</span><br><span class="line"></span><br><span class="line">geth --dev --rpc --rpccorsdomain &quot;*&quot; --rpcaddr &quot;0.0.0.0&quot; --rpcport &quot;8545&quot; --mine --rpcapi &quot;eth,txpool,web3&quot;</span><br><span class="line"></span><br><span class="line">geth --testnet --rpc --rpccorsdomain &quot;*&quot; --rpcaddr &quot;0.0.0.0&quot; --rpcport &quot;8545&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;truffle-框架使用&quot;&gt;&lt;a href=&quot;#truffle-框架使用&quot; class=&quot;headerlink&quot; title=&quot;truffle 框架使用&quot;&gt;&lt;/a&gt;truffle 框架使用&lt;/h1&gt;&lt;p&gt;&lt;strong&gt; uiste@uiste:~$     te
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>安装walle后进行检测错误总出现的问题解决</title>
    <link href="http://blog.uiste.com/2018/20181023-1.html"/>
    <id>http://blog.uiste.com/2018/20181023-1.html</id>
    <published>2018-10-23T01:05:48.000Z</published>
    <updated>2018-10-23T01:31:13.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装walle后进行检测错误总出现的问题解决"><a href="#安装walle后进行检测错误总出现的问题解决" class="headerlink" title="安装walle后进行检测错误总出现的问题解决"></a>安装walle后进行检测错误总出现的问题解决</h1><p>安装好 walle后，进行项目配置，但是检测总是出现错误，错误如下：</p><p>宿主机代码检出检测出错，请确认把php进程用户www的ssh-key加入git的deploy-keys列表。</p><p>目标机器检测出错，请确认php进程www用户ssh-key加入目标机器的www用户ssh-key信任列表。</p><p>目标机 ansible ping 出错，请检查 ~/.ssh/config 及 ssh 证书配置<br>目标机器检测出错，请确认www有目标机器发布版本库/data/www/publish写入权限。</p><p>解决方法：<br>  1，在宿主机安装了ansible后，就消灭了一个关于ansible未安装的问题</p><p>  2，其实我们是把宿主机器php进程用户www加入了目标机器www用户的信任authired_keys表的，但是任然报未加入，此处，主要的错误就是因为我们在目标机器中对于</p><pre><code>www用户的.ssh文件夹和authorized_keys的权限和所属者；chmod -R 755 /home/www/chmod -R 700 /home/www/.ssh/chmod -R 644 /home/www/.ssh/authorized_keys </code></pre><p> 必须满足以上三个条件才能免密码登录，同时也是解决总报没有加入目标机器信任列表的问题关键</p><p> <code>chown  www.www -R /home/www</code>      将所属者为www用户</p><blockquote><p>需要记住的宿主机和目标机器的  .ssh   authorized_keys      /home/www/   都需要注意权限问题  </p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;安装walle后进行检测错误总出现的问题解决&quot;&gt;&lt;a href=&quot;#安装walle后进行检测错误总出现的问题解决&quot; class=&quot;headerlink&quot; title=&quot;安装walle后进行检测错误总出现的问题解决&quot;&gt;&lt;/a&gt;安装walle后进行检测错误总出现的问题
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Mysql 相关命令</title>
    <link href="http://blog.uiste.com/2018/20181022-1.html"/>
    <id>http://blog.uiste.com/2018/20181022-1.html</id>
    <published>2018-10-22T02:56:08.000Z</published>
    <updated>2018-10-22T02:57:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mysql-添加阿里RDS远程登陆用户"><a href="#Mysql-添加阿里RDS远程登陆用户" class="headerlink" title="Mysql 添加阿里RDS远程登陆用户"></a>Mysql 添加阿里RDS远程登陆用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; select user,host from user;</span><br><span class="line">mysql&gt; grant all privileges on *.* to &apos;dms&apos;@&apos;121.43.18.67&apos; identified by &apos;mypassword&apos;;</span><br><span class="line">mysql&gt; flush privileges; </span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Mysql-添加阿里RDS远程登陆用户&quot;&gt;&lt;a href=&quot;#Mysql-添加阿里RDS远程登陆用户&quot; class=&quot;headerlink&quot; title=&quot;Mysql 添加阿里RDS远程登陆用户&quot;&gt;&lt;/a&gt;Mysql 添加阿里RDS远程登陆用户&lt;/h1&gt;&lt;figu
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>此项目将被立刻删除，您不能撤销此操作</title>
    <link href="http://blog.uiste.com/2018/20181021-1.html"/>
    <id>http://blog.uiste.com/2018/20181021-1.html</id>
    <published>2018-10-21T08:36:14.000Z</published>
    <updated>2018-10-22T01:47:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>mac 删除文件不经过废纸篓，提示“此项目将被立刻删除，您不能撤销此操作。”，解决办法。</p><p>终端机运行两个命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -R ~/.Trash</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure></p><p>退出终端机。</p><p>如果它说你没有权限删除，那么就这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -R ~/.Trash</span><br><span class="line">killall Finder</span><br></pre></td></tr></table></figure></p><p>删除废纸篓，finder会自动生成。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;mac 删除文件不经过废纸篓，提示“此项目将被立刻删除，您不能撤销此操作。”，解决办法。&lt;/p&gt;
&lt;p&gt;终端机运行两个命令：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;spa
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux 配置，命令</title>
    <link href="http://blog.uiste.com/2018/20181019-2.html"/>
    <id>http://blog.uiste.com/2018/20181019-2.html</id>
    <published>2018-10-19T07:58:26.000Z</published>
    <updated>2019-01-01T14:59:22.500Z</updated>
    
    <content type="html"><![CDATA[<h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2><h3 id="添加管理员用户"><a href="#添加管理员用户" class="headerlink" title="添加管理员用户"></a>添加管理员用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># useradd test</span><br><span class="line"># passwd test</span><br><span class="line"># mkdir -p /home/test/.ssh</span><br><span class="line"># chown 600 /home/test/.ssh/</span><br><span class="line"># vim /etc/sudoers</span><br><span class="line"># cd /home/test/.ssh/</span><br><span class="line"># rz</span><br><span class="line"># # Received /Users/uiste/.ssh/id_rsa.pub</span><br><span class="line"># ls</span><br><span class="line"># mv id_rsa.pub authorized_keys</span><br><span class="line"># ls -al</span><br><span class="line"># chown test:test authorized_keys </span><br><span class="line"># chmod 700 authorized_keys </span><br><span class="line"># ls -al</span><br><span class="line"># chmod 600 authorized_keys </span><br><span class="line"># ls</span><br><span class="line"># pwd</span><br><span class="line"># chown test:test /home/test/.ssh</span><br><span class="line"># ls -al /home/test/</span><br><span class="line"></span><br><span class="line"># 自定义生成ssh key</span><br><span class="line">root@iZbp1bb2egi7vzn29c1dhvZ ~]# su - www</span><br><span class="line">上一次登录：二 1月  1 22:49:16 CST 2019pts/1 上</span><br><span class="line">[www@iZbp1bb2egi7vzn29c1dhvZ ~]$ sudo su -</span><br><span class="line">Last login: Tue Jan  1 22:49:46 CST 2019 from 223.167.32.98 on pts/2</span><br><span class="line">[root@iZbp1bb2egi7vzn29c1dhvZ ~]# su - www</span><br><span class="line">Last login: Tue Jan  1 22:50:58 CST 2019 on pts/2</span><br><span class="line">[www@iZbp1bb2egi7vzn29c1dhvZ ~]$ ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># useradd test</span><br><span class="line"></span><br><span class="line">修改管理员配置</span><br><span class="line"># vim /etc/sudoers</span><br><span class="line"></span><br><span class="line">## Allow root to run any commands anywhere </span><br><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">test     ALL=(ALL)       NOPASSWD: ALL</span><br></pre></td></tr></table></figure><h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 切换自定用户</span><br><span class="line"># su - test</span><br><span class="line"></span><br><span class="line"># 切换root用户</span><br><span class="line"># sudo su -</span><br></pre></td></tr></table></figure><h3 id="配置SSH"><a href="#配置SSH" class="headerlink" title="配置SSH"></a>配置SSH</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">chown test:test /home/test/</span><br><span class="line">chmod 755 /home/test/.ssh/</span><br><span class="line"></span><br><span class="line">[test@izbp14s0hny0qt9wghm6lcz .ssh]$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 test test 4096 Sep 26 10:54 .</span><br><span class="line">drwx------ 3 test test 4096 Sep 26 10:44 ..</span><br><span class="line">-rw------- 1 test test  411 Sep 26 10:36 authorized_keys</span><br><span class="line"></span><br><span class="line">[test@izbp14s0hny0qt9wghm6lcz .ssh]$ cat authorized_keys </span><br><span class="line">ssh-rsa AAAAB3Nza...E27svfEF6qsVb9B5dooFFFS5hNjyJJma8dyCLzmpAKXH......8XDB+ofAZYkF/7NyU9ON0OwkKWJL4jL570kfazGgJQQwrjWh5x5.....nLsLvQB2rnjbeyV+RXnNemMutokrjIgrT Administrator@PC-20180613WOHL</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">## 常用命令</span><br><span class="line">* 递归创建文件夹</span><br><span class="line">`mkdir -p /data/yiilogs/`</span><br><span class="line"></span><br><span class="line">* 修改文件夹用户</span><br><span class="line">`chown test:test /data/yiilogs/`</span><br><span class="line"></span><br><span class="line">* 修改文件读写权限</span><br><span class="line">`chmod 777 /data/yiilogs/`</span><br><span class="line"></span><br><span class="line">* 查看端口占用情况</span><br><span class="line">`netstat -tunlp | grep 3306`</span><br><span class="line"></span><br><span class="line">* 匹配log中自定内容信息</span><br></pre></td></tr></table></figure><p>tail -f /data/yiilog/xxx/access_app_nginx.log |grep ‘interface-loan/xxx’<br><code>`</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;服务器配置&quot;&gt;&lt;a href=&quot;#服务器配置&quot; class=&quot;headerlink&quot; title=&quot;服务器配置&quot;&gt;&lt;/a&gt;服务器配置&lt;/h2&gt;&lt;h3 id=&quot;添加管理员用户&quot;&gt;&lt;a href=&quot;#添加管理员用户&quot; class=&quot;headerlink&quot; title=
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>lnmp环境 (centos7+nginx+MySQL5.7.9+PHP7)</title>
    <link href="http://blog.uiste.com/2018/20181019-1.html"/>
    <id>http://blog.uiste.com/2018/20181019-1.html</id>
    <published>2018-10-19T07:30:50.000Z</published>
    <updated>2019-03-25T08:59:46.095Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><p><strong> 首先更新系统软件 </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum update</span><br></pre></td></tr></table></figure></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol><li><p>安装nginx源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum localinstall http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>安装nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br></pre></td></tr></table></figure></li><li><p>启动nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># service nginx start</span><br><span class="line">Redirecting to /bin/systemctl start  nginx.service</span><br></pre></td></tr></table></figure></li><li><p>访问http://你的ip/</p></li></ol><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/service.conf</span><br><span class="line"></span><br><span class="line"># api-doc.xxx.com</span><br><span class="line">server &#123;</span><br><span class="line">listen 80; #默认监听 80 端口</span><br><span class="line">server_name api-doc.xxx.com; #配置域名或者公网 ip</span><br><span class="line">location / &#123;</span><br><span class="line">   proxy_pass http://127.0.0.1:4000;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># api-doc.xxx.com</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  api-doc.xxx.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /data/web/blackuser-api-doc/_book;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny  all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># admin.xxx.com</span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name admin.xxx.com;</span><br><span class="line">    root /data/web/xxx/backend/web; # 该项要修改为你准备存放相关网页的路径</span><br><span class="line">    location / &#123;</span><br><span class="line">        index  index.php index.html index.htm;</span><br><span class="line">         #如果请求既不是一个文件，也不是一个目录，则执行一下重写规则</span><br><span class="line">         if (!-e $request_filename)</span><br><span class="line">         &#123;</span><br><span class="line">            #地址作为将参数rewrite到index.php上。</span><br><span class="line">            rewrite ^/(.*)$ /index.php/$1;</span><br><span class="line">            #若是子目录则使用下面这句，将subdir改成目录名称即可。</span><br><span class="line">            #rewrite ^/subdir/(.*)$ /subdir/index.php/$1;</span><br><span class="line">         &#125;</span><br><span class="line">#deny all;</span><br><span class="line">    &#125;</span><br><span class="line">    #proxy the php scripts to php-fpm</span><br><span class="line">    location ~ \.php &#123;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">            ##pathinfo支持start</span><br><span class="line">            #定义变量 $path_info ，用于存放pathinfo信息</span><br><span class="line">            set $path_info &quot;&quot;;</span><br><span class="line">            #定义变量 $real_script_name，用于存放真实地址</span><br><span class="line">            set $real_script_name $fastcgi_script_name;</span><br><span class="line">            #如果地址与引号内的正则表达式匹配</span><br><span class="line">            if ($fastcgi_script_name ~ &quot;^(.+?\.php)(/.+)$&quot;) &#123;</span><br><span class="line">                    #将文件地址赋值给变量 $real_script_name</span><br><span class="line">                    set $real_script_name $1;</span><br><span class="line">                    #将文件地址后的参数赋值给变量 $path_info</span><br><span class="line">                    set $path_info $2;</span><br><span class="line">            &#125;</span><br><span class="line">            #配置fastcgi的一些参数</span><br><span class="line">            fastcgi_param SCRIPT_FILENAME $document_root$real_script_name;</span><br><span class="line">            fastcgi_param SCRIPT_NAME $real_script_name;</span><br><span class="line">            fastcgi_param PATH_INFO $path_info;</span><br><span class="line">            ###pathinfo支持end</span><br><span class="line">        fastcgi_intercept_errors on;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ^~ /data/runtime &#123;</span><br><span class="line">    return 404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ^~ /application &#123;</span><br><span class="line">    return 404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ^~ /simplewind &#123;</span><br><span class="line">    return 404;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="安装MySQL5-7"><a href="#安装MySQL5-7" class="headerlink" title="安装MySQL5.7.*"></a>安装MySQL5.7.*</h2><h3 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h3><ol><li><p>安装mysql源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum localinstall  http://dev.mysql.com/get/mysql57-community-release-el7-7.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>安装mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure></li><li><p>安装mysql的开发包，以后会有用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-devel</span><br></pre></td></tr></table></figure></li><li><p>启动mysql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure></li><li><p>查看mysql启动状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># service mysqld status</span><br><span class="line">出现pid</span><br><span class="line"></span><br><span class="line">证明启动成功</span><br></pre></td></tr></table></figure></li><li><p>获取mysql默认生成的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># grep &apos;temporary password&apos; /var/log/mysqld.log</span><br><span class="line">选中的就是密码。</span><br></pre></td></tr></table></figure></li><li><p>换成自己的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p</span><br><span class="line">mysql&gt;  set global validate_password_policy=0; # 默认是1，即MEDIUM，所以刚开始设置的密码必须符合长度，且必须含有数字，小写或大写字母，特殊字符。有时候，只是为了自己测试，不想密码设置得那么复杂，譬如说，我只想设置root的密码为123456。</span><br><span class="line">mysql&gt;  set global validate_password_length=1; # validate_password_number_count指定了密码中数据的长度，validate_password_special_char_count指定了密码中特殊字符的长度，validate_password_mixed_case_count指定了密码中大小字母的长度。这些参数，默认值均为1，所以validate_password_length最小值为4，如果你显性指定validate_password_length的值小于4，尽管不会报错，但validate_password_length的值将设为4。</span><br><span class="line">mysql&gt;  ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;MyNewPasdfs4!&apos;;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"># mysql -uroot -p</span><br></pre></td></tr></table></figure></li></ol><h2 id="编译安装php7-0-1"><a href="#编译安装php7-0-1" class="headerlink" title="编译安装php7.0.1"></a>编译安装php7.0.1</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><ol><li><p>下载php7源码包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd /root &amp; wget -O php7.tar.gz http://cn2.php.net/get/php-7.1.2.tar.gz/from/this/mirror</span><br></pre></td></tr></table></figure></li><li><p>解压源码包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tar -xvf php7.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>进入目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cd php-7.0.1</span><br></pre></td></tr></table></figure></li><li><p>安装php依赖包　</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel</span><br></pre></td></tr></table></figure></li><li><p>编译配置，这里如果上一步的某些依赖包没有安装好，就会遇到很多configure error，我们一一解决，安装上相关软件开发包就可以</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"># ./configure \</span><br><span class="line">--prefix=/usr/local/php \</span><br><span class="line">--with-config-file-path=/etc \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--with-fpm-user=www  \</span><br><span class="line">--with-fpm-group=www \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--disable-debug \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-shared  \</span><br><span class="line">--enable-soap \</span><br><span class="line">--with-libxml-dir \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-pcre-regex \</span><br><span class="line">--with-sqlite3 \</span><br><span class="line">--with-zlib \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--with-iconv \</span><br><span class="line">--with-bz2 \</span><br><span class="line">--enable-calendar \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-cdb \</span><br><span class="line">--enable-dom \</span><br><span class="line">--enable-exif \</span><br><span class="line">--enable-fileinfo \</span><br><span class="line">--enable-filter \</span><br><span class="line">--with-pcre-dir \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--with-gd \</span><br><span class="line">--with-openssl-dir \</span><br><span class="line">--with-jpeg-dir \</span><br><span class="line">--with-png-dir \</span><br><span class="line">--with-zlib-dir  \</span><br><span class="line">--with-freetype-dir \</span><br><span class="line">--enable-gd-native-ttf \</span><br><span class="line">--enable-gd-jis-conv \</span><br><span class="line">--with-gettext \</span><br><span class="line">--with-gmp \</span><br><span class="line">--with-mhash \</span><br><span class="line">--enable-json \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-mbregex-backtrack \</span><br><span class="line">--with-libmbfl \</span><br><span class="line">--with-onig \</span><br><span class="line">--enable-pdo \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd \</span><br><span class="line">--with-zlib-dir \</span><br><span class="line">--with-pdo-sqlite \</span><br><span class="line">--with-readline \</span><br><span class="line">--enable-session \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-simplexml \</span><br><span class="line">--enable-sockets  \</span><br><span class="line">--enable-sysvmsg \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-sysvshm \</span><br><span class="line">--enable-wddx \</span><br><span class="line">--with-libxml-dir \</span><br><span class="line">--with-xsl \</span><br><span class="line">--enable-zip \</span><br><span class="line">--enable-mysqlnd-compression-support \</span><br><span class="line">--with-pear \</span><br><span class="line">--enable-opcache</span><br></pre></td></tr></table></figure></li><li><p>编译与安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li><li><p>添加 PHP 命令到环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/profile</span><br><span class="line"></span><br><span class="line">在末尾加入</span><br><span class="line"></span><br><span class="line">PATH=$PATH:/usr/local/php/bin</span><br><span class="line">export PATH</span><br><span class="line"></span><br><span class="line">要使改动立即生效执行</span><br><span class="line"># source /etc/profile</span><br></pre></td></tr></table></figure></li><li><p>查看环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># echo $PATH</span><br><span class="line"># php -v</span><br></pre></td></tr></table></figure></li></ol><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><ol><li><p>配置php-fpm</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cp php.ini-production /etc/php.ini</span><br><span class="line"># cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line"># cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span><br><span class="line"># cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line"># chmod +x /etc/init.d/php-fpm</span><br></pre></td></tr></table></figure></li><li><p>启动php-fpm</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/php-fpm start</span><br></pre></td></tr></table></figure></li></ol><p><strong> 异常处理 </strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">configure error:</span><br><span class="line"></span><br><span class="line">1.configure: error: xml2-config not found. Please check your libxml2 installation.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libxml2 libxml2-devel&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">2.configure: error: Cannot find OpenSSL&apos;s &lt;evp.h&gt;</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install openssl openssl-devel&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">3.configure: error: Please reinstall the BZip2 distribution</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install bzip2 bzip2-devel&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">4.configure: error: Please reinstall the libcurl distribution - easy.h should be in &lt;curl-dir&gt;/include/curl/</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libcurl libcurl-devel&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">5.If configure fails try --with-webp-dir=&lt;DIR&gt; configure: error: jpeglib.h not found.</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libjpeg libjpeg-devel&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">6.If configure fails try --with-webp-dir=&lt;DIR&gt;</span><br><span class="line"></span><br><span class="line">checking for jpeg_read_header in -ljpeg... yes</span><br><span class="line"></span><br><span class="line">configure: error: png.h not found.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libpng libpng-devel&lt;/span&gt;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">7.If configure fails try --with-webp-dir=&lt;DIR&gt;</span><br><span class="line"></span><br><span class="line">checking for jpeg_read_header in -ljpeg... yes</span><br><span class="line"></span><br><span class="line">checking for png_write_image in -lpng... yes</span><br><span class="line"></span><br><span class="line">If configure fails try --with-xpm-dir=&lt;DIR&gt;</span><br><span class="line"></span><br><span class="line">configure: error: freetype-config not found.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install freetype freetype-devel&lt;/span&gt;</span><br><span class="line">8.configure: error: Unable to locate gmp.h</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install gmp gmp-devel&lt;/span&gt;</span><br><span class="line">9.configure: error: mcrypt.h not found. Please reinstall libmcrypt.</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libmcrypt libmcrypt-devel</span><br><span class="line"></span><br><span class="line">10.configure: error: Please reinstall readline - I cannot find readline.h</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install readline readline-devel&lt;/span&gt;</span><br><span class="line">11.configure: error: xslt-config not found. Please reinstall the libxslt &gt;= 1.1.0 distribution</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line"></span><br><span class="line"># yum install libxslt libxslt-devel&lt;/span&gt;</span><br></pre></td></tr></table></figure></p><h2 id="修改服务运行用户"><a href="#修改服务运行用户" class="headerlink" title="修改服务运行用户"></a>修改服务运行用户</h2><h3 id="修改nginx的运行角色"><a href="#修改nginx的运行角色" class="headerlink" title="修改nginx的运行角色"></a>修改nginx的运行角色</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx</span><br><span class="line">sudo vi nginx.conf</span><br><span class="line"># 头部是这样</span><br><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line"># 修改为</span><br><span class="line">user test;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">#重启nginx</span><br><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure><h3 id="修改php的运行角色"><a href="#修改php的运行角色" class="headerlink" title="修改php的运行角色"></a>修改php的运行角色</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/php/7.0/fpm/pool.d/</span><br><span class="line">sudo vi www.conf</span><br><span class="line"># 找到</span><br><span class="line">user = www-data</span><br><span class="line">group = www-data</span><br><span class="line"></span><br><span class="line"># 改为</span><br><span class="line">user = test</span><br><span class="line">group = test</span><br><span class="line"></span><br><span class="line">cd /run/php/</span><br><span class="line">ls -al</span><br><span class="line"># 这个目录下面有两个文件</span><br><span class="line"># php7.0-fpm.pid和php7.0-fpm.sock</span><br><span class="line"># 修改这两个文件的权限</span><br><span class="line">sudo chown test:test php7.0-fpm.pid</span><br><span class="line">sudo chown test:test php7.0-fpm.sock</span><br><span class="line"></span><br><span class="line"># 重启php-fpm</span><br><span class="line">sudo service php7-fpm restart</span><br></pre></td></tr></table></figure><blockquote><p>test用户是杜撰出来的根据自己的当前用户修改</p></blockquote><h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart</span><br><span class="line">service php-fpm restart</span><br></pre></td></tr></table></figure><h2 id="配置服务开启启动"><a href="#配置服务开启启动" class="headerlink" title="配置服务开启启动"></a>配置服务开启启动</h2><p>开机自启动nginx，php-fpm（其他服务类似）<br>centos 7以上是用Systemd进行系统初始化的，Systemd 是 Linux 系统中最新的初始化系统（init），它主要的设计目标是克服 sysvinit 固有的缺点，提高系统的启动速度。<br>Systemd服务文件以.service结尾，比如现在要建立nginx为开机启动，如果用yum install命令安装的，yum命令会自动创建nginx.service文件，直接用命令systemcel enable nginx.service设置开机启动即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemcel enable nginx.service</span><br></pre></td></tr></table></figure></p><p>源码安装的手动建立nginx.service服务文件<br>在系统服务目录里创建nginx.service文件<br><code>vi /lib/systemd/system/nginx.service</code></p><p>写入以下内容（路径改成自己的）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/www/lnmp/nginx/sbin/nginx -c /www/lnmp/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/www/lnmp/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/www/lnmp/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p><p>在系统服务目录里创建php-fpm.service文件<br><code>vi /lib/systemd/system/php-fpm.service</code></p><p>写入以下内容（路径改成自己的）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=php-fpm</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/www/lnmp/php/sbin/php-fpm</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p><blockquote><p>Description:描述服务<br>After:描述服务类别<br>[Service]服务运行参数的设置<br>Type=forking是后台运行的形式<br>ExecStart为服务的具体运行命令<br>ExecReload为重启命令<br>ExecStop为停止命令<br>PrivateTmp=True表示给服务分配独立的临时空间<br>注意：[Service]的启动、重启、停止命令全部要求使用绝对路径<br>[Install]运行级别下服务安装的相关设置，可设置为多用户，即系统运行级别为3<br>测试并加入开机自启<br>先关闭nginx，php-fpm<br>使用以下命令开启<br><code>systemctl start nginx.service</code>             #如果服务是开启状态，使用此命令会启动失败。<br><code>systemctl start php-fpm.service</code></p></blockquote><p>开启成功，将服务加入开机自启<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx.service                #注意后面不能跟空格</span><br><span class="line">systemctl enable php-fpm.service</span><br></pre></td></tr></table></figure></p><p>重启服务器，查看是否启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r now        #重启</span><br><span class="line"></span><br><span class="line">systemctl list-units --type=service           #查看运行的服务</span><br></pre></td></tr></table></figure></p><p>其他命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx.service              #启动nginx服务</span><br><span class="line">systemctl enable nginx.service             #设置开机自启动</span><br><span class="line">systemctl disable nginx.service            #停止开机自启动</span><br><span class="line">systemctl status nginx.service             #查看服务当前状态</span><br><span class="line">systemctl restart nginx.service　          #重新启动服务</span><br><span class="line">systemctl list-units --type=service        #查看所有已启动的服务</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;安装nginx&quot;&gt;&lt;a href=&quot;#安装nginx&quot; class=&quot;headerlink&quot; title=&quot;安装nginx&quot;&gt;&lt;/a&gt;安装nginx&lt;/h2&gt;&lt;p&gt;&lt;strong&gt; 首先更新系统软件 &lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;high
      
    
    </summary>
    
    
      <category term="lnmp" scheme="http://blog.uiste.com/tags/lnmp/"/>
    
  </entry>
  
  <entry>
    <title>Mac OS X下配置远程Linux 服务器SSH密钥认证自动登录</title>
    <link href="http://blog.uiste.com/2017/20171223-1.html"/>
    <id>http://blog.uiste.com/2017/20171223-1.html</id>
    <published>2017-12-23T04:19:17.000Z</published>
    <updated>2018-10-19T01:57:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在本地机器创建公钥"><a href="#在本地机器创建公钥" class="headerlink" title="在本地机器创建公钥"></a>在本地机器创建公钥</h2><p>打开万能的终端，执行如下命令，无视一切输出，一路欢快地回车即可。</p><p>ssh-keygen -t rsa -C  ‘your <a href="mailto:email@domain.com" target="_blank" rel="noopener">email@domain.com</a>‘<br>-t 指定密钥类型，默认即 rsa ，可以省略<br>-C 设置注释文字，比如你的邮箱</p><h2 id="将公钥复制到ssh服务器"><a href="#将公钥复制到ssh服务器" class="headerlink" title="将公钥复制到ssh服务器"></a>将公钥复制到ssh服务器</h2><p>将前一步骤生成的公钥~/id_rsa.pub文件，复制到ssh服务器对应用户下的~/.ssh/authorized_keys文件,可以有多种方式，这里只介绍常用的三种。</p><p>[适用于osx系统]使用ssh-copy-id-for-OSX工具将公钥复制至ssh服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install ssh-copy-id</span><br><span class="line">ssh-copy-id username@hostname  #将username和hostname替换为你的ssh服务器用户名和IP</span><br><span class="line">当ssh服务器username用户目录下尚未有.ssh目录时使用此方式</span><br><span class="line">cat ~/.ssh/id_rsa.pub | ssh username@hostname &quot;mkdir ~/.ssh; cat &gt;&gt; ~/.ssh/authorized_keys&quot;</span><br></pre></td></tr></table></figure><p>通用方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_rsa.pub username@hostname:~/ #将公钥文件复制至ssh服务器</span><br><span class="line">ssh username@hostname #使用用户名和密码方式登录至ssh服务器</span><br><span class="line">mkdir .ssh  #若.ssh目录已存在，可省略此步</span><br><span class="line">cat id_rsa.pub &gt;&gt; .ssh/authorized_keys  #将公钥文件id_rsa.pub文件内容追加到authorized_keys文件</span><br></pre></td></tr></table></figure><h2 id="快捷登录"><a href="#快捷登录" class="headerlink" title="快捷登录"></a>快捷登录</h2><p>完成以上步骤后，即可使用以下命令直接登录ssh服务器，妈妈再也不用担心你记不住密码了</p><p>ssh username@hostname #将username替换为你的ssh服务器用户名，hostname替换为服务器的ip<br>但是，每次仍然需要输入ssh username@hostname，仍算不上最优的解决方案，要是能实现一键登录或一条命令登录最好不过了，下面来看看都有那些解决方法</p><p>ssh本身也提供了一种快捷的方式来解决这个问题，往~/.ssh/config配置文件添加你的ssh服务器信息即可<br>vim ~/.ssh/config   #若没有该文件，直接新建即可<br>添加文件内容格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host        alias #自定义别名</span><br><span class="line">    HostName        hostname  #替换为你的ssh服务器ip或domain</span><br><span class="line">    Port            port #ssh服务器端口，默认为22</span><br><span class="line">    User            user #ssh服务器用户名</span><br><span class="line">    IdentityFile    ~/.ssh/id_rsa #第一个步骤生成的公钥文件对应的私钥文件</span><br></pre></td></tr></table></figure><p>保存文件退出后，即可使用别名登录ssh服务器</p><p>ssh alias #alias是你在~/.ssh/config文件配置的别名<br>若有多个ssh账号需要配置，只要在~/.ssh/config空行再写即可，如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Host        foo</span><br><span class="line">    HostName        192.168.2.222</span><br><span class="line">    Port            22</span><br><span class="line">    User            test</span><br><span class="line">    IdentityFile    ~/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">Host        alias</span><br><span class="line">    HostName    hostname</span><br><span class="line">    Port        port</span><br><span class="line">    User        user</span><br></pre></td></tr></table></figure><p>如果你本地终端使用的是zsh，那就太简单不过了，直接给zsh添加一条别名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;alias ssh-to-username=&apos;ssh username@hostname&apos;&quot; &gt;&gt; ~/.zshrc #将username和hostname替换为你的服务器信息</span><br><span class="line">source ~/.zshrc   #重新加载更改后的zshrc文件</span><br><span class="line">ssh-to-username   #使用别名，一条命令即可登录你的ssh服务器</span><br></pre></td></tr></table></figure><p>如果你本地终端使用的是iterm2还可以添加Profile实现一键登录，具体步骤此处略过</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;在本地机器创建公钥&quot;&gt;&lt;a href=&quot;#在本地机器创建公钥&quot; class=&quot;headerlink&quot; title=&quot;在本地机器创建公钥&quot;&gt;&lt;/a&gt;在本地机器创建公钥&lt;/h2&gt;&lt;p&gt;打开万能的终端，执行如下命令，无视一切输出，一路欢快地回车即可。&lt;/p&gt;
&lt;p&gt;ss
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>字符串的gzip压缩与解压的整理</title>
    <link href="http://blog.uiste.com/2017/20170722-1.html"/>
    <id>http://blog.uiste.com/2017/20170722-1.html</id>
    <published>2017-07-21T16:29:24.000Z</published>
    <updated>2018-10-19T01:57:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>背景介绍<br>因为一直在处理restful API，给移动端提供的数据需要考虑流量问题，优先考虑就是压缩现有的字符串，然后再考虑业务逻辑方面的减少流量。鉴于找这些资料也花了不少时间，所以整理了这篇文章，留作纪念。<br>参考网址<br>PHP与C#的压缩与解压<br><a href="http://www.oschina.net/question/2265205_181108" target="_blank" rel="noopener">http://www.oschina.net/question/2265205_181108</a><br><a href="http://my.oschina.net/linland/blog/217769?fromerr=Kf9b6ElQ" target="_blank" rel="noopener">http://my.oschina.net/linland/blog/217769?fromerr=Kf9b6ElQ</a><br><a href="http://www.yiibai.com/sql/function.gzencode.html" target="_blank" rel="noopener">http://www.yiibai.com/sql/function.gzencode.html</a></p><p><a href="https://forums.xamarin.com/discussion/33607/using-system-io-compression-in-pcl" target="_blank" rel="noopener">https://forums.xamarin.com/discussion/33607/using-system-io-compression-in-pcl</a></p><p>=====================<br>python的压缩与解压</p><p><a href="http://outofmemory.cn/code-snippet/2030/Python-usage-gzip-pack-shujubao" target="_blank" rel="noopener">http://outofmemory.cn/code-snippet/2030/Python-usage-gzip-pack-shujubao</a><br><a href="http://www.cnblogs.com/mmix2009/p/3221371.html" target="_blank" rel="noopener">http://www.cnblogs.com/mmix2009/p/3221371.html</a></p><h1 id="http-blog-csdn-net-lxdcyh-article-details-4021476"><a href="#http-blog-csdn-net-lxdcyh-article-details-4021476" class="headerlink" title="http://blog.csdn.net/lxdcyh/article/details/4021476"></a><a href="http://blog.csdn.net/lxdcyh/article/details/4021476" target="_blank" rel="noopener">http://blog.csdn.net/lxdcyh/article/details/4021476</a></h1><p>javascript的压缩与解压<br><a href="http://stackoverflow.com/questions/14620769/decompress-gzip-and-zlib-string-in-javascript" target="_blank" rel="noopener">http://stackoverflow.com/questions/14620769/decompress-gzip-and-zlib-string-in-javascript</a><br><a href="http://nodeca.github.io/pako/" target="_blank" rel="noopener">http://nodeca.github.io/pako/</a></p><p>代码具体实现<br>PHP (&gt;=5.4)</p><p>[php] view plain copy<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$srcString=<span class="string">"1"</span>;  </span><br><span class="line">$srcCompress=base64_encode(gzencode($srcString,<span class="number">9</span>));  </span><br><span class="line"><span class="keyword">echo</span> strlen($srcCompress).<span class="string">'---压缩后字符串长度&lt;br/&gt;'</span>;  </span><br><span class="line">$newString=base64_decode($srcCompress);  </span><br><span class="line">$newString=gzdecode($newString);  </span><br><span class="line"><span class="keyword">echo</span> $newString.<span class="string">'----解压后原字符串&lt;br/&gt;'</span>;</span><br></pre></td></tr></table></figure></p><p>c#<br>(建议还是考虑各个平台的，PCL版本下的见前面的网址，但是没调试通过)</p><p>[csharp] view plain copy<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">using System.IO.Compression;  </span><br><span class="line">using System.Text;  </span><br><span class="line">public  string Compress (string text)  </span><br><span class="line">&#123;  </span><br><span class="line">byte[] buffer = Encoding.UTF8.GetBytes (text);  </span><br><span class="line">using (MemoryStream ms = new MemoryStream ()) &#123;  </span><br><span class="line">GZipStream Compress = new GZipStream (ms, CompressionMode.Compress);  </span><br><span class="line">  </span><br><span class="line">Compress.Write (buffer, 0, buffer.Length);  </span><br><span class="line">  </span><br><span class="line">Compress.Close ();  </span><br><span class="line">  </span><br><span class="line">return Convert.ToBase64String (ms.ToArray ());  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">public string Decompress (string text)  </span><br><span class="line">&#123;  </span><br><span class="line">byte[] buffer = Convert.FromBase64String (text);  </span><br><span class="line">using (MemoryStream tempMs = new MemoryStream ()) &#123;  </span><br><span class="line">using (MemoryStream ms = new MemoryStream (buffer)) &#123;  </span><br><span class="line">GZipStream Decompress = new GZipStream (ms, CompressionMode.Decompress);  </span><br><span class="line">  </span><br><span class="line">Decompress.CopyTo (tempMs);  </span><br><span class="line">  </span><br><span class="line">Decompress.Close ();  </span><br><span class="line">  </span><br><span class="line">return Encoding.UTF8.GetString (tempMs.ToArray ());  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>python<br>[python] view plain copy<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8  </span></span><br><span class="line"><span class="keyword">import</span> base64  </span><br><span class="line"><span class="keyword">import</span> StringIO,gzip  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zipData</span><span class="params">( content)</span>:</span>  </span><br><span class="line">    zbuf = StringIO.StringIO()  </span><br><span class="line">    zfile = gzip.GzipFile(mode=<span class="string">'wb'</span>, compresslevel=<span class="number">9</span>, fileobj=zbuf)  </span><br><span class="line">    zfile.write(content)  </span><br><span class="line">    zfile.close()  </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(zbuf.getvalue())  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unzipData</span><span class="params">(content)</span>:</span>  </span><br><span class="line">    compresseddata=base64.b64decode(content)  </span><br><span class="line">    compressedstream = StringIO.StringIO(compresseddata)  </span><br><span class="line">    gzipper = gzip.GzipFile(fileobj=compressedstream)  </span><br><span class="line">    data = gzipper.read()  </span><br><span class="line">    <span class="keyword">return</span> data  </span><br><span class="line">s=zipData(<span class="string">"1"</span>)  </span><br><span class="line"><span class="keyword">print</span> s  </span><br><span class="line">s1=unzipData(s)  </span><br><span class="line"><span class="keyword">print</span> s1</span><br></pre></td></tr></table></figure></p><p>javascript<br>[html] view plain copy<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;  </span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;  </span><br><span class="line">&lt;script src=<span class="string">"http://code.jquery.com/jquery-2.1.4.min.js"</span>&gt;&lt;/script&gt;  </span><br><span class="line">&lt;script src=<span class="string">"https://raw.githubusercontent.com/nodeca/pako/master/dist/pako.js"</span>&gt;&lt;/script&gt;  </span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gzip</span>(<span class="params">string</span>) </span>&#123;  </span><br><span class="line"><span class="keyword">var</span> charData    = string.split(<span class="string">''</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x.charCodeAt(<span class="number">0</span>);&#125;);  </span><br><span class="line"><span class="keyword">var</span> binData     = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(charData);  </span><br><span class="line"><span class="keyword">var</span> data= pako.gzip(binData);  </span><br><span class="line"><span class="keyword">var</span> strData= <span class="built_in">String</span>.fromCharCode.apply(<span class="literal">null</span>, <span class="keyword">new</span> <span class="built_in">Uint16Array</span>(data));  </span><br><span class="line"><span class="keyword">return</span> btoa(strData);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ungzip</span>(<span class="params">string</span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line"><span class="keyword">var</span> strData     = atob(string);  </span><br><span class="line"><span class="keyword">var</span> charData    = strData.split(<span class="string">''</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x.charCodeAt(<span class="number">0</span>);&#125;);  </span><br><span class="line"><span class="keyword">var</span> binData     = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(charData);  </span><br><span class="line"><span class="keyword">var</span> data= pako.ungzip(binData);  </span><br><span class="line"><span class="keyword">var</span> strData= <span class="built_in">String</span>.fromCharCode.apply(<span class="literal">null</span>, <span class="keyword">new</span> <span class="built_in">Uint16Array</span>(data));  </span><br><span class="line"><span class="keyword">return</span> strData;  </span><br><span class="line">&#125;  </span><br><span class="line">test=<span class="string">"1"</span>;  </span><br><span class="line"><span class="keyword">var</span> s=gzip(test);  </span><br><span class="line">alert(s);  </span><br><span class="line">alert(ungzip(s));  </span><br><span class="line">&lt;<span class="regexp">/script&gt;  </span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;  </span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;背景介绍&lt;br&gt;因为一直在处理restful API，给移动端提供的数据需要考虑流量问题，优先考虑就是压缩现有的字符串，然后再考虑业务逻辑方面的减少流量。鉴于找这些资料也花了不少时间，所以整理了这篇文章，留作纪念。&lt;br&gt;参考网址&lt;br&gt;PHP与C#的压缩与解压&lt;br&gt;&lt;a
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>关于file_get_contents(&quot;php://input&quot;)</title>
    <link href="http://blog.uiste.com/2017/20170721-1.html"/>
    <id>http://blog.uiste.com/2017/20170721-1.html</id>
    <published>2017-07-21T15:13:13.000Z</published>
    <updated>2018-10-19T01:57:01.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>“php://input allows you to read raw POST data. It is a less memory intensive alternative to $HTTP_RAW_POST_DATA and does not need any special php.ini directives. php://input is not available with enctype=”multipart/form-data”. </p></blockquote><p>翻译过来，是这样：<br>“php://input可以读取没有处理过的POST数据。相较于$HTTP_RAW_POST_DATA而言，它给内存带来的压力较小，并且不需要特殊的php.ini设置。php://input不能用于enctype=multipart/form-data”<br>找了一通资料，原来是这么回事：</p><p>1，Coentent-Type仅在取值为application/x-www-data-urlencoded和multipart/form-data两种情况下，</p><p>PHP才会将http请求数据包中相应的数据填入全局变量$_POST </p><p>2，PHP不能识别的Content-Type类型的时候，会将http请求包中相应的数据填入变量$HTTP_RAW_POST_DATA </p><p>3, 只有Coentent-Type不为multipart/form-data的时候，PHP不会将http请求数据包中的相应数据填入php://input，</p><p>否则其它情况都会。填入的长度，由Coentent-Length指定。 </p><p>4，只有Content-Type为application/x-www-data-urlencoded时，php://input数据才跟$_POST数据相一致。 </p><p>5，php://input数据总是跟$HTTP_RAW_POST_DATA相同，但是php://input比$HTTP_RAW_POST_DATA更凑效，</p><p>且不需要特殊设置php.ini </p><p>6，PHP会将PATH字段的query_path部分，填入全局变量$_GET。通常情况下，GET方法提交的http请求，body为空。</p><p>从官网信息来看，php://input是一个只读信息流，当请求方式是post的，并且enctype不等于”multipart/form-data”时，可以使用php://input来获取原始请求的数据。</p><p>看一个简单的例子。</p><p>客户端就是一个表单，非常简单。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"tom"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    age:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"22"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将表单提交到服务端，服务端使用file_get_contents获取php://input内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$content = file_get_contents(<span class="string">"php://input"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $content; <span class="comment">//输出name=tom&amp;amp;age=22</span></span><br></pre></td></tr></table></figure><p>官网关于php://input的说明中，反复有提到$HTTP_RAW_POST_DATA这个变量，这个变量其实和file_get_contents(php://input)的内容是一样的。如果要开启这个变量，需要修改配置文件，找到always_populate_raw_post_data这个选项，设置为On，然后重新启动web服务器，就可以了。而使用php://input不需要修改php配置文件。</p><p>在项目应用中，如摄像头拍照，上传保存，就可以用到php://input。客户端拍照后，把图片流传送到服务端，服务端使用file_get_getcontents(‘php://input’)就能获取到图片流，然后把图片流保存到一个文件，这个文件就是图片了</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;“php://input allows you to read raw POST data. It is a less memory intensive alternative to $HTTP_RAW_POST_DATA and does not
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>gitbook安装与使用</title>
    <link href="http://blog.uiste.com/2017/20170719-1.html"/>
    <id>http://blog.uiste.com/2017/20170719-1.html</id>
    <published>2017-07-18T16:02:05.000Z</published>
    <updated>2018-10-19T01:57:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="gitbook安装"><a href="#gitbook安装" class="headerlink" title="gitbook安装"></a>gitbook安装</h2><ol><li>安装npm<br>从网站 <a href="https://nodejs.org/#download" target="_blank" rel="noopener">https://nodejs.org/#download</a> 下载node.js源代码（点击绿色的INSTALL），<br>解压<br>./configure<br>make<br>make install<br>成功执行后，npm就被安装好了。</li></ol><ol start="2"><li>gitbook 安装<br><code>npm install -g gitbook-cli</code><br><code>gitbook -V</code><br>查看gitbook是否安装成功。</li></ol><h2 id="gitbook使用"><a href="#gitbook使用" class="headerlink" title="gitbook使用"></a>gitbook使用</h2><ol><li>根据目录生成图书结构 </li></ol><p>1.1 README.md 与 SUMMARY编写<br>README.md<br>这个文件相当于一本Gitbook的简介。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir test_gitbook</span><br><span class="line">$ touch README.md</span><br></pre></td></tr></table></figure></p><p>SUMMARY.md<br>这个文件是一本书的目录结构，使用Markdown语法，<br>如我们这本书的SUMMARY.md：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ touch SUMMARY.md</span><br><span class="line">$ vim SUMMARY.md</span><br></pre></td></tr></table></figure></p><p>输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* [简介](README.md)</span><br><span class="line">* [第一章](chapter1/README.md)</span><br><span class="line"> - [第一节](chapter1/section1.md)</span><br><span class="line"> - [第二节](chapter1/section2.md)</span><br><span class="line">* [第二章](chapter2/README.md)</span><br><span class="line"> - [第一节](chapter2/section1.md)</span><br><span class="line"> - [第二节](chapter2/section2.md)</span><br><span class="line">* [结束](end/README.md)</span><br></pre></td></tr></table></figure><p>1.2 生成图书结构<br>当这个目录文件创建好之后，我们可以使用Gitbook<br>的命令行工具将这个目录结构生成相应的目录及文件：<br>$ gitbook init<br>$ tree . #查看建立的目录和文件<br>.<br>├── chapter1<br>│   ├── README.md<br>│   ├── section1.md<br>│   └── section2.md<br>├── chapter2<br>│   ├── README.md<br>│   ├── section1.md<br>│   └── section2.md<br>├── end<br>│   └── README.md<br>├── README.md<br>└── SUMMARY.md</p><p>我们可以看到，gitbook给我们生成了与SUMMARY.md所<br>对应的目录及文件。</p><p>每个目录中，都有一个README.md文件，相当于一章的说明。</p><ol start="2"><li>生成图书</li></ol><p>2.1 输出为静态网站<br>你有两种方式输出一个静态网站：<br>2.1.1 本地预览时自动生成<br>当你在自己的电脑上编辑好图书之后，你可以使用Gitbook<br>的命令行进行本地预览：</p><p><code>$ gitbook serve</code></p><p>然后浏览器中输入 <a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a> 就可以预览生<br>成的以网页形式组织的书籍。<br>这里你会发现，你在你的图书项目的目录中多了一个名为<br>_book的文件目录，而这个目录中的文件，即是生成的静态<br>网站内容。<br>使用build参数生成到指定目录<br>与直接预览生成的静态网站文件不一样的是，使用这个命令，<br>你可以将内容输入到你所想要的目录中去：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /tmp/gitbook</span><br><span class="line">$ gitbook build --output=/tmp/gitbook</span><br></pre></td></tr></table></figure></p><p>2.2 输出PDF<br>输入为PDF文件，需要先使用NPM安装上gitbook pdf：<br><code>$ sudo npm install gitbook-pdf -g</code><br>我在执行上面这条命令的时候出现了下面的错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">***************************************************</span><br><span class="line">Downloading http://cdn.bitbucket.org/ariya/phantomjs/downloads/phantomjs-1.9.7-linux-i686.tar.bz2</span><br><span class="line">Saving to /usr/local/lib/node_modules/gitbook-pdf/node_modules/phantomjs/phantomjs/phantomjs-1.9.7-linux-i686.tar.bz2</span><br><span class="line">Error: connect ETIMEDOUT</span><br><span class="line">    at exports._errnoException (util.js:746:11)</span><br><span class="line">    at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1010:19)</span><br><span class="line">npm ERR! Linux 3.2.0-4-686-pae</span><br><span class="line">npm ERR! argv &quot;/usr/local/bin/node&quot; &quot;/usr/local/bin/npm&quot; &quot;install&quot; &quot;gitbook-pdf&quot; &quot;-g&quot;</span><br><span class="line">npm ERR! node v0.12.7</span><br><span class="line">npm ERR! npm  v2.11.3</span><br><span class="line">npm ERR! code ELIFECYCLE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm ERR! phantomjs@1.9.7-5 install: `node install.js`</span><br><span class="line">npm ERR! Exit status 1</span><br><span class="line">npm ERR! </span><br><span class="line">npm ERR! Failed at the phantomjs@1.9.7-5 install script &apos;node install.js&apos;.</span><br><span class="line">npm ERR! This is most likely a problem with the phantomjs package,</span><br><span class="line">npm ERR! not with npm itself.</span><br><span class="line">npm ERR! Tell the author that this fails on your system:</span><br><span class="line">npm ERR!     node install.js</span><br><span class="line">npm ERR! You can get their info via:</span><br><span class="line">npm ERR!     npm owner ls phantomjs</span><br><span class="line">npm ERR! There is likely additional logging output above.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm ERR! Please include the following file with any support request:</span><br><span class="line">npm ERR!     /home/wangxq/repository/phantomjs/npm-debug.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************************</span><br></pre></td></tr></table></figure></p><p>由错误报告内容的第一行可以知道，发生错误的原因是下载<br>phantomjs发生了错误，因此我们需要手动下载和安装。</p><p>解决方法：[1]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git://github.com/ariya/phantomjs.git</span><br><span class="line">$ sudo apt-get install build-essential g++ flex bison gperf ruby perl \</span><br><span class="line">  libsqlite3-dev libfontconfig1-dev libicu-dev libfreetype6 libssl-dev \</span><br><span class="line">  libpng-dev libjpeg-dev python libx11-dev libxext-dev       #安装编译需要的工具和依赖</span><br><span class="line">$ cd phantomjs</span><br><span class="line">$ git checkout 1.9.7  #注意：这里的1.9.7是phantom的版本号，可以由错误报告的第一行找出 </span><br><span class="line">$ ./build.sh --jobs 4</span><br><span class="line">$ sudo cp bin/phantomjs /bin/</span><br><span class="line">$ sudo npm install gitbook-pdf -g  #重新进行安装</span><br></pre></td></tr></table></figure></p><p>然后，使用下面的命令，要PDF文件，首先安装依赖库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install calibre  </span><br><span class="line">$ gitbook -v 2.1.0 pdf</span><br></pre></td></tr></table></figure><p>发生错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">*****************************************************</span><br><span class="line">info: start conversion to pdf ....ERROR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error: Command failed: /bin/sh -c ebook-convert /tmp/tmp-29384ctltwbk/SUMMARY.html /tmp/tmp-29384ctltwbk/index.pdf --title=&quot;&quot; --comments=&quot;这本书是gitbook的一个例子&quot; --language=&quot;en&quot; --book-producer=&quot;GitBook&quot; --publisher=&quot;GitBook&quot; --chapter=&quot;descendant-or-self::*[contains(concat(&apos; &apos;, normalize-space(@class), &apos; &apos;), &apos; book-chapter &apos;)]&quot; --chapter-mark=&quot;pagebreak&quot; --page-breaks-before=&quot;/&quot; --level1-toc=&quot;descendant-or-self::*[contains(concat(&apos; &apos;, normalize-space(@class), &apos; &apos;), &apos; book-chapter-1 &apos;)]&quot; --level2-toc=&quot;descendant-or-self::*[contains(concat(&apos; &apos;, normalize-space(@class), &apos; &apos;), &apos; book-chapter-2 &apos;)]&quot; --level3-toc=&quot;descendant-or-self::*[contains(concat(&apos; &apos;, normalize-space(@class), &apos; &apos;), &apos; book-chapter-3 &apos;)]&quot; --no-chapters-in-toc --max-levels=&quot;1&quot; --breadth-first --margin-left=&quot;62&quot; --margin-right=&quot;62&quot; --margin-top=&quot;56&quot; --margin-bottom=&quot;56&quot; --pdf-default-font-size=&quot;12&quot; --pdf-mono-font-size=&quot;12&quot; --paper-size=&quot;a4&quot; --pdf-header-template=&quot;&lt;p class=&apos;header&apos;&gt;&lt;span&gt;&lt;/span&gt;&lt;/p&gt;&quot; --pdf-footer-template=&quot;&lt;p class=&apos;footer&apos;&gt;&lt;span&gt;_SECTION_&lt;/span&gt; &lt;span style=&apos;float:right;&apos;&gt;_PAGENUM_&lt;/span&gt;&lt;/p&gt;&quot;</span><br><span class="line">Usage: ebook-convert input_file output_file [options]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Convert an ebook from one format to another.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_file is the input and output_file is the output. Both must be specified as the first two arguments to the command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The output ebook format is guessed from the file extension of output_file. output_file can also be of the special format .EXT where EXT is the output file extension. In this case, the name of the output file is derived the name of the input file. Note that the filenames must not start with a hyphen. Finally, if output_file has no extension, then it is treated as a directory and an &quot;open ebook&quot; (OEB) consisting of HTML files is written to that directory. These files are the files that would normally have been passed to the output plugin.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">After specifying the input and output file you can customize the conversion by specifying various options. The available options depend on the input and output file types. To get help on them specify the input and output file and then use the -h option.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">For full documentation of the conversion system see</span><br><span class="line">http://manual.calibre-ebook.com/conversion.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Whenever you pass arguments to ebook-convert that have spaces in them, enclose the arguments in quotation marks.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ebook-convert: error: no such option: --pdf-default-font-size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*****************************************************</span><br></pre></td></tr></table></figure></p><p>解决方法[2]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -v &amp;&amp; wget -nv -O- https://raw.githubusercontent.com/kovidgoyal/calibre/master/setup/linux-installer.py | sudo python -c &quot;import sys; main=lambda:sys.stderr.write(&apos;Download failed\n&apos;); exec(sys.stdin.read()); main()&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ gitbook -v 2.1.0 pdf .  # 重新执行命令生成pdf，目标文件为book.pdf</span><br></pre></td></tr></table></figure></p><blockquote><p><code>https://github.com/zhangjikai/gitbook-use/</code></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;gitbook安装&quot;&gt;&lt;a href=&quot;#gitbook安装&quot; class=&quot;headerlink&quot; title=&quot;gitbook安装&quot;&gt;&lt;/a&gt;gitbook安装&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;安装npm&lt;br&gt;从网站 &lt;a href=&quot;https://nodejs
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>绊脚石</title>
    <link href="http://blog.uiste.com/2017/20170410-1.html"/>
    <id>http://blog.uiste.com/2017/20170410-1.html</id>
    <published>2017-04-09T16:22:02.000Z</published>
    <updated>2018-10-19T01:57:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天发布了这样一条朋友圈：</p><blockquote><p>有时候，一些不是特别良好的状态产生时，都会有一种体验特别不舒服的忧虑感。大多数这种情况的产生最终还是会产生正面的结果。因为在敢于承担的过程，在问题解决以后会觉得某些地方有些提升。所以今天的忧虑都是靠这个说服自己。</p></blockquote><p><img src="http://7xwlfk.com1.z0.glb.clouddn.com/%E5%9F%BA%E6%9C%AC%E4%B8%8A%E6%98%AF%E8%BF%99%E6%A0%B7%E4%B8%80%E4%B8%AA%E6%83%85%E5%86%B5.png" alt="基本上是这样一个情况  "><br>这段话引起了朋友进一步追问的兴趣，我凯凯而回，说只是装X的东西。自己又想表达的一个观点是，老罗说他创业五年很多失败的经历是成长过程宝贵的财富。自己有意去挖掘一些这样的失败案例。到不为自己所为的成功，但却有成长的必要。</p><p>想到这里，突然想到，学生时代看过的一些求职面试宝典，说面试官可能会问你之前的工作生活中，遇到的最大的空难是什么，你是如何解决的。虽然，以后可能找工作的次数不会太多。但好像此刻对这个问题，有了比较豁然的想法：又要重复那段话了。战胜的最大困难，就是心理斗争的过程，多数的时候由于不好的状态产生时，这种心理上的阴影是最大困难的产生，我有及其良好的态度能说服自己承担下来，战胜它。最后会凯凯而笑，自己又成长了。</p><p>这样的素材，希望能够不断的积累，可能有这些，会让自己的人生道路变得充实一些吧。</p><p>说了好多也都在总结一些空话。素材只做点录：渠道产品逻辑调整，解决终极问题，虽有风险顾虑，却有勇气坚持自己的观点。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今天发布了这样一条朋友圈：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;有时候，一些不是特别良好的状态产生时，都会有一种体验特别不舒服的忧虑感。大多数这种情况的产生最终还是会产生正面的结果。因为在敢于承担的过程，在问题解决以后会觉得某些地方有些提升。所以今天的忧虑都是靠这个说服
      
    
    </summary>
    
    
  </entry>
  
</feed>
